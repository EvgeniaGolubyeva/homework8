"use strict";function navbarDirective(){return{scope:!1,restrict:"E",templateUrl:"views/partial/navbar.html",controller:NavbarController,controllerAs:"ctrl"}}function footerDirective(){return{scope:!1,restrict:"E",templateUrl:"views/partial/footer.html"}}function datePickerDirective(){return{restrict:"E",templateUrl:"views/partial/datePicker.html",scope:{minDate:"=min",ngModel:"="},controller:DatePickerController,controllerAs:"ctrl",require:"ngModel",link:function(a,b){var c=b.controller("ngModel");c.$formatters.push(function(b){var d=b>=a.minDate;return c.$setValidity("date",d),d?b:a.minDate})}}}function priceRangeDirective(){return{restrict:"E",templateUrl:"views/partial/priceRange.html",scope:{attrMinPrice:"@minPrice",attrMaxPrice:"@maxPrice",lowPrice:"=",highPrice:"="},link:function(a,b){a.minPrice=parseInt(a.attrMinPrice)||0,a.maxPrice=parseInt(a.attrMaxPrice)||500;var c=angular.element(b).find('div[class="priceRangeSlider"]');c.slider({min:a.minPrice,max:a.maxPrice,values:[a.lowPrice||a.minPrice,a.highPrice||a.maxPrice],range:!0,slide:function(b,c){return a.$apply(function(){a.lowPrice=c.values[0],a.highPrice=c.values[1]})}}),a.$watch("lowPrice",function(b){var d=c.slider("values");c.slider("values",[b||a.minPrice,d[1]])}),a.$watch("highPrice",function(b){var d=c.slider("values");c.slider("values",[d[0],b||a.maxPrice])})}}}function searchFormDirective(){return{restrict:"E",templateUrl:"views/partial/searchForm.html",scope:{},controller:SearchFormController,controllerAs:"ctrl"}}var PageTitles=function(){function a(){}return a.HOME="Home",a.SEARCH="Search",a.PRODUCT="Product",a}(),auctionApplication=angular.module("auction",["ngRoute","ui.bootstrap","restangular"]);auctionApplication.config(["$routeProvider",function(a){a.when("/",{templateUrl:"views/home.html",controller:"HomeController",controllerAs:"ctrl",title:PageTitles.HOME,resolve:HomeController.resolve}).when("/search",{templateUrl:"views/search.html",controller:"SearchController",controllerAs:"ctrl",title:PageTitles.SEARCH,resolve:SearchController.resolve}).when("/product/:id",{templateUrl:"views/product.html",controller:"ProductController",controllerAs:"ctrl",title:PageTitles.PRODUCT,resolve:ProductController.resolve}).otherwise({redirectTo:"/"})}]),auctionApplication.config(["RestangularProvider",function(a){a.setBaseUrl("http://localhost:8080/auction/server")}]),auctionApplication.run(["$rootScope",function(a){a.$on("$routeChangeStart",function(b,c){a.title=c.title})}]);var auction;!function(a){!function(a){var b=function(){function a(){}return a}();a.Product=b}(a.model||(a.model={}));a.model}(auction||(auction={}));var auction;!function(a){!function(a){var b=function(){function a(){}return a}();a.Bid=b}(a.model||(a.model={}));a.model}(auction||(auction={}));var auction;!function(a){!function(a){var b=function(){function a(a,b,c,d){this.restangular=a,this.$location=b,this.$log=c,this.$q=d,this.restangularResource=this.restangular.all("product")}return a.prototype.getFeaturedProducts=function(){return this.restangularResource.one("featured").get()},a.prototype.getSearchProducts=function(a){return this.restangularResource.one("search").get(a)},a.prototype.getProduct=function(a){return this.restangularResource.one(a).get()},a.prototype.placeBid=function(a,b){return this.restangularResource.one(a.toString()).all("bid").post(b)},a.prototype.getProductBids=function(a){return this.restangularResource.one(a).one("bid").get()},a.prototype.getCategories=function(){var a=this.$q.defer();return a.resolve(["Category 1","Category 2","Category 3","Category 4"]),a.promise},a.$inject=["Restangular","$location","$log","$q"],a}();a.ProductService=b,angular.module("auction").service("ProductService",b)}(a.service||(a.service={}));a.service}(auction||(auction={}));var auction;!function(a){!function(a){var b=function(){function a(){}return a.prototype.watchBids=function(a,b){this.webSocket=new WebSocket("ws://localhost:8080/auction/server/product/"+a+"/bidws"),this.webSocket.onmessage=function(a){return b(JSON.parse(a.data))}},a.prototype.placeBid=function(a){this.webSocket.send(JSON.stringify(a))},a.prototype.unwatchBids=function(){this.webSocket.close()},a}();a.BidService=b,angular.module("auction").service("BidService",b)}(a.service||(a.service={}));a.service}(auction||(auction={}));var HomeController=function(){function a(a){this.featuredProducts=a}return a.$inject=["featuredProducts"],a.resolve={featuredProducts:["ProductService",function(a){return a.getFeaturedProducts()}]},a}();angular.module("auction").controller("HomeController",HomeController);var SearchController=function(){function a(a){this.searchProducts=a}return a.$inject=["searchProducts"],a.resolve={searchProducts:["ProductService","$location",function(a,b){return a.getSearchProducts(b.search())}]},a}();angular.module("auction").controller("SearchController",SearchController);var ProductController=function(){function a(a,b,c,d,e){var f=this;this.$scope=a,this.product=b,this.bids=c,this.productService=d,this.bidService=e,this.bidsCount=this.bids.length,this.topPrice=this.bidsCount>0?this.bids[0].amount:this.product.minimalPrice,e.watchBids(b.id,function(b){a.$apply(function(){return f.processServerResponse(b)})}),a.$on("$destroy",function(){return e.unwatchBids()})}return a.prototype.placeBid=function(){{var a=this;this.productService.placeBid(this.product.id,this.createBid()).then(function(b){a.processServerResponse(b)})}},a.prototype.placeBidWS=function(){this.bidService.placeBid(this.createBid())},a.prototype.createBid=function(){var a=new auction.model.Bid;return a.amount=this.bidAmount,a.user={id:1,name:"user1",email:"user1@mail.com",getOverbidNotifications:!0},a},a.prototype.processServerResponse=function(a){"rejected"==a.status?(this.alertClass="alert-warning",this.placeBidResponseMessage=a.reason):"win"==a.status?(this.alertClass="alert-success",this.placeBidResponseMessage=a.reason):(this.placeBidResponseMessage="Bid was succesfully placed",this.alertClass="alert-info",this.topPrice=a.topBidPrice,this.bidsCount=a.totalCountOfBids)},a.$inject=["$scope","product","bids","ProductService","BidService"],a.resolve={product:["ProductService","$route",function(a,b){return a.getProduct(b.current.params.id)}],bids:["ProductService","$route",function(a,b){return a.getProductBids(b.current.params.id)}]},a}();angular.module("auction").controller("ProductController",ProductController);var NavbarController=function(){function a(a,b){var c=this;this.$rootScope=a,this.$location=b,this.search=function(){c.$location.path("/search"),c.productTitle&&c.$location.search({title:c.productTitle})},this.isSearchVisible=function(){return"Home"==c.$rootScope.title}}return a.$inject=["$rootScope","$location"],a}();angular.module("auction").directive("auctionNavbar",navbarDirective),angular.module("auction").directive("auctionFooter",footerDirective);var DatePickerController=function(){function a(){this.isPopupOpened=!1}return a.prototype.openPopup=function(a){a.preventDefault(),a.stopPropagation(),this.isPopupOpened=!0},a}();angular.module("auction").directive("auctionDatePicker",datePickerDirective),angular.module("auction").directive("auctionPriceRange",priceRangeDirective);var SearchCriteria=function(){function a(){}return a.fromStringObject=function(b){return angular.extend(new a,b,{lowPrice:b.lowPrice?parseInt(b.lowPrice):0,highPrice:b.highPrice?parseInt(b.highPrice):500,numberOfBids:b.numberOfBids?parseInt(b.numberOfBids):0,date:b.date?new Date(b.date):new Date})},a.toStringObject=function(a){return angular.extend({},a,{date:a.date.toISOString()})},a}(),SearchFormController=function(){function a(a,b){var c=this;this.$location=b,this.minDate=new Date,this.searchCriteria=SearchCriteria.fromStringObject(b.search()),this.minDate.setHours(0,0,0,0),a.getCategories().then(function(a){return c.categories=a})}return a.prototype.search=function(){this.$location.path("/search"),this.$location.search(SearchCriteria.toStringObject(this.searchCriteria))},a.$inject=["ProductService","$location"],a}();angular.module("auction").directive("auctionSearchForm",searchFormDirective);